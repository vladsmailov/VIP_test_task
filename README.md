## VIP_test_task
## Тестовое задание на вакансию инженер-программист (python), в компанию НПК ВИП
### Дата выполнения: 17.07.23, Автор: Смаилов Владислав
## Инструкция по развертыванию проекта:
1. Клонируем репозиторий:

   ```git clone https://github.com/vladsmailov/VIP_test_task.git```

3. Создаем виртуальное окружение:

   ```
   cd VIP_test_task
   python3 -m venv venv
   ```

5. Активируем виртуальное окружение:

   ```source venv/bin/activate```

6. Устанавилваем необходимые для работы приложения пакеты:

   ```pip3 install -r requirements.txt```

## Создание БД

1. Устанавливаем необходимые для работы БД пакеты:

   ```sudo apt install postgresql postgresql-contrib -y ```


   После установки автоматически создаётся юнит для сервера PostgreSQL и настраивается его конфигурация:
   это значит, что демон systemd будет поддерживать постоянную работу сервера PostgreSQL и автоматически загружать его при каждом запуске системы.


2. Настраиваем файл конфигурации БД

   > postgres.conf

   Расположенный в директории

   > /etc/postgresl/14/main/

   По-умолчанию порт для подключения имеет значение

   >5432
   >Изменим его на
   >1027

3. В командной строке от имени пользователя postgres вызовем утилиту psql, это программа-клиент для подключения и управления СУБД:

   ```sudo -u postgres psql```
  

4. Изменим пароль пользователя postgres на postgres:

   ```
   ALTER USER postgres
   WITH PASSWORD 'postgres';
   ```

5. Создадим файл с переменными окружения

    >    .env
    
    В него запишем параметры для подключения к БД

   >DB_USER = "postgres"
   > 
   >DB_PASSWORD = "postgres"
   > 
   >DB_HOST = "localhost"
   > 
   >DB_PORT = 1027
   > 
   >DB_NAME = "postgres"

6. Сгенерируем миграцию:

   ```alembic revision --autogenerate -m 'initial' ```


7. Выполним миграцию:

   ```alembic upgrade head```
   

8. Заполняем БД тестовыми данными:

   Либо через интерфейс 
        
    >    psql

      либо через  
    
    >PGAdmin
   
   Обратитк внимание, что в строке:

   >FROM 'path/to/file/file_name.txt' DELIMITER ',' CSV HEADER;

   Необходимо изменить путь на путь к файлу с данными, так же папка расположения данными должна иметь достаточно нихкий уровень доступа, чтобы PGAdmin мог прочитать файл.

    ```
      COPY "Product"(
      created_at, updated_at, deleted_at, id, pid, sequence_number,
       status, order_in, decimal_number_id, output_number, status_info)
      FROM 'path/to/file/file_name.txt' DELIMITER ',' CSV HEADER;
    ```

9. Аналогично заполняем таблицу 
   > DecimalNumber
   
## Запуск проекта

1. Запуск проекта осуществляется либо из терминала, либо из интерфейса IDE:

   ```pethon3 main.py ```

    Далее в терминале последовательно появятся подсказки, какую переменную на вход ждет программа:

   >start - значение для поля created_at объекта Product
   > 
   >end - значение для поля updated_at объекта Product
   > 
   >decimal_number(name) - значение поля name объекта DecimalNumber, указывается опционально

   Программа получает на вход 2 или 3 переменные и делает запрос к БД, формируя отчет, если переданы параметры start и end, то программа вернет все объекты Product со значениями created_at>=start, updated_at<=end, если поле updated_at у объекта Product пустое, но поле status имеет значение IN_PROGRESS, эти объекты тоже будут включены в отчет.
   Если переданы три параметра, то будет дополнительно сделан запрос к таблице DecimalNumber, где по имени объекта будет возвращен его id, этот id будет включен как один из параметров запроса к таблице Product, таким образом мы получим все объекты с соответствующими датами создания и обновления и подходящим decimal_number_id. Если же в таблице DecimalNumber Отсутствует запрашиваемый объект, программа вернет ошибку.


2. После выполнения алгоритма отчет будет сохранен в папке
   
   > reports
    
   в формате 

   > name start end
